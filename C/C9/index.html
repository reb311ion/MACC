<!DOCTYPE html><html lang="en"><head>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>The C Compilation Process</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="../../arabic.css"></head>
  <body>
    <div id="loading">
      <div id="spinner"></div>
    </div>
    <a href="/" class="go_back"><i class="fas fa-arrow-left"></i></a>
    <div id="background_overlay"></div>
    <div id="background" style="background: url(top_image.png) center;"></div>
    <table id="profile_blog">
    </table>
    <table id="profile_blog">
    </table>
    <div id="blog-display">
      <h1 id="blog_title">A Crash Course in C - Part 8</h1>
      <h2 id="blog_sub_title">the C Compilation Process.</h2>
<div  id='write'  class = 'is-node'><h3><a name="عملية-التجميع-في-لغة-c" class="md-header-anchor"></a><mark><span>عملية التجميع في لغة C</span></mark></h3><blockquote><p><span>عملية التجميع في لغة C تنقسم الي اربع اجزاء تبدأ من مرحلة ما قبل التجميع  Preprocessing لمرحلة التجميع  Compiling و الـ Assembling  يليهم المرحلة الأخيرة و هي الربط  Linking. تقوم المترجمات بترجمة او تحويل الملفات المصدرية إلي لغة منخفضة المستوي إن لم تكن هناك أخطاء في قواعد اللغة، يمكن تحويل الملفات المصدرية إلي لغة التجميع Assembly Languge أو إلي لغة الألة Machine Languge مباشرة.</span></p></blockquote><p><img src="C++_compilation_process.svg.png" referrerpolicy="no-referrer" alt="C++_compilation_process.svg"></p><p><span>في البداية يتم تمرير الملف المصدري للمًجمع Compiler والذي يمثل الواجهة لمكوناته:</span></p><ul><li><span>الـ preprocessor المسؤول عن مرحلة ما قبل التجميع  preprocessing في تلك المرحلة تتم عدة عمليات من التحويلات النصية و تبديل النصوص تتضمن تبديل اسماء االملفات الرأسية header files المعرفة عن طريق الموجه </span><code>include#</code><span> بمحتواها بداخل الملف المصدري  و تبديل كل الثوابت الرمزية symbolic constants المعرفة عن طريق الموجه </span><code>define#</code><span>  بقيمتها.</span></li></ul><ul><li><span>الـ lexical analyser يقوم بعد ذلك بقراءة الملف و تحويل النصوص بداخله لرموز tokens و التأكد من صحة تلك الرموز.</span></li></ul><p><img src="graph.png" referrerpolicy="no-referrer" alt="graph"></p><p><span>  المثال التالي يوضح كيف سيكون شكل الملف المصدري بعد تضمين الرموز:</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 12px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> <span class="cm-variable">value</span> <span class="cm-operator">=</span> <span class="cm-number">100</span>;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 20px;"></div><div class="CodeMirror-gutters" style="display: none; height: 20px;"></div></div></div></pre><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 12px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">int</span> (<span class="cm-variable">keyword</span>), <span class="cm-variable">value</span> (<span class="cm-variable">identifier</span>), <span class="cm-operator">=</span> (<span class="cm-variable">operator</span>), <span class="cm-number">100</span> (<span class="cm-variable">constant</span>) <span class="cm-variable">and</span> ; (<span class="cm-variable">symbol</span>).</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 20px;"></div><div class="CodeMirror-gutters" style="display: none; height: 20px;"></div></div></div></pre><ul><li><span>الـ parser بعد ذلك سيقوم بأخذ الـ tokens و ترتيبها منطقيا في مجموعات تسمي التعبيرات expressions و يطلق علي هذه التعبيرات غالبا  expression trees</span></li><li><span>الـ optimiser وهو مرحلة غير مشروط تواجدها بداخل المجمع في تلك، المرحلة يتم التعديل علي التعبيرات من الـ parser  لإنتاج برنامج اسرع و اصغر حجما</span></li><li><span>المجمع بعد ذلك يقوم بتحويل التعبيرات إلي لغة الـ Assembly و هي لغة اقرب للالة منها للبشر و تختلف بختلاف بنية المعالج CPU Archticture الشكل التالي يوضح ما يمكن ان يكون عليه برنامج C بسيط عند تحويله للغة الـ Assembly في معمارية </span><code>x86</code><span> :</span></li></ul><p><img src="image-20191205205608325.png" referrerpolicy="no-referrer" alt="image-20191205205608325"></p><p><img src="image-20191205210022513.png" referrerpolicy="no-referrer" alt="image-20191205210022513"></p><p><span>بعد ذلك يأتي دور الـ Assembler و الذي سيترجم ملفات الـ Assembly الي ملفات تحمل تعليمات لغة الألة  و تسمي تلك الملفات بالملفات الكائنية object files.</span>
<span> اخر خطوة تكون المُربط Linker و فيه يتم دمج  الـ object files مع بعضها البعض و ربطها مع المكتبات التي يتسخدمها البرنامج لإنشاء ملف تنفيذي يمكن تشغيله.</span></p><h3><a name="انواع-الربط-linking" class="md-header-anchor"></a><mark><span>انواع الربط Linking</span></mark></h3><blockquote><p><span>المٌربط Linker يُستخدم لربط اكثر من ملف كائني في ملف تنفيذي واحد و ربط ذلك الملف التنفيذي بالمكتبات التي يستخدمها و ينقسم ذلك النوع من ربط المكتبات بالملف التنفيذي الي نوعين: الربط الثابت  Static Linking و الربط الديناميكي  Dynamic linking و لكل نوع منهم اغراضه و ما يميزه عن الأخر.</span></p></blockquote><h4><a name="الربط-الثابت-static-linking" class="md-header-anchor"></a><mark><span>الربط الثابت Static Linking</span></mark></h4><p><span>في ذلك النوع يتم تضمين كل دوال المكتبة المستخدمة داخل الملف التنفيذي و نتيجة لذلك يكون حجم البرنامج اكبر و يستهلك مساحة اكبر من الذاكرة اثناء تشغيله و لكنه لا يحتاج لوجود المكتبة علي نظام التشغيل ليعمل</span></p><p><img src="image-20191226191554761.png" referrerpolicy="no-referrer" alt="image-20191226191554761"></p><h4><a name="الربط-الديناميكي-dynamic-linking" class="md-header-anchor"></a><mark><span>الربط الديناميكي Dynamic Linking</span></mark></h4><p><span>في ذلك النوع لا يتم ربط الدوال بالملف التنفيذي، عوض ذلك يتم تضمين قائمة الدوال المستخدمة وإضافة تعليمات برمجية تتولي عملية استدعاء المكتبات و ربط الدوال المستخدمة فيها بالملف التنفيذي و يسمي ذلك النوع ايضا بالربط الديناميكي الضمني </span><code>Implicit dynamic linking</code><span> وهو الأكثر شيوعا و المستخدم بشكل تلقائي في معظم المجمعات.</span></p><p><span>هناك نوع اخر شائع بين البرمجيات الخبيثة لا يستدعي استخدام المُربط ليعمل و هو نوع الربط الديناميكي الصريح </span><code>Explicit Dynamic Linking</code><span> و فيه يقوم الملف التنفيذي بتحميل المكتبة و استخدام الدوال داخلها اثناء عملية التشغيل بدون وجود رابط مسبق بينهم و  يسمي ذلك النوع ايضا </span><code>Run-Time dynamic linking</code><span>. مثال علي الـ</span><code>Explicit Dynamic Linking</code><span> بستخدام الـ </span><code>Windows APIs</code><span> (سيتم شرح استخدام الـ Windows APIs تفصيلا عند التطرق لتحليل البرمجيات الخبيثة).</span></p><pre spellcheck="false" class="md-fences md-end-block ty-contain-cm modeLoaded" lang="c" style="break-inside: unset;"><div class="CodeMirror cm-s-inner CodeMirror-wrap" lang="c"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 0px; left: 12px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-meta">#include &lt;windows.h&gt;</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-keyword">typedef</span> <span class="cm-variable-3">int</span> (<span class="cm-variable">WINAPI</span> <span class="cm-operator">*</span><span class="cm-variable">MESSAGEBOX</span>)(<span class="cm-variable">HWND</span> , <span class="cm-variable">LPCSTR</span>, <span class="cm-variable">LPCSTR</span>, <span class="cm-variable">DWORD</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span class="cm-variable-3">void</span> <span class="cm-def">main</span>(<span class="cm-variable-3">void</span>)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">MESSAGEBOX</span> <span class="cm-variable">lpfMsgBox</span> <span class="cm-operator">=</span> <span class="cm-variable">NULL</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">HINSTANCE</span> <span class="cm-variable">hLib</span>;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">hLib</span> <span class="cm-operator">=</span> <span class="cm-variable">LoadLibrary</span>(<span class="cm-string">"User32.dll"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">lpfMsgBox</span> <span class="cm-operator">=</span> <span class="cm-variable">GetProcAddress</span>(<span class="cm-variable">hLib</span>,<span class="cm-string">"MessageBoxA"</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;<span class="cm-variable">lpfMsgBox</span>(<span class="cm-number">0</span>, <span class="cm-string">"Run-Time Dynamic Linking is so cool right?"</span>, <span class="cm-string">"Run-Time Dynamic Linking"</span>, <span class="cm-variable">MB_OK</span>);</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom: 0px solid transparent; top: 280px;"></div><div class="CodeMirror-gutters" style="display: none; height: 280px;"></div></div></div></pre><p><img src="image-20191226200103796.png" referrerpolicy="no-referrer" alt="image-20191226200103796"></p><p>&nbsp;</p><p>&nbsp;</p></div>
    </div>
    <script type="text/javascript">
      setTimeout(function() {
        document.getElementById("loading").classList.add("animated");
        document.getElementById("loading").classList.add("fadeOut");
        setTimeout(function() {
          document.getElementById("loading").classList.remove("animated");
          document.getElementById("loading").classList.remove("fadeOut");
          document.getElementById("loading").style.display = "none";
        }, 800);
      }, 1500);
      $.getJSON("../../config.json", function(user) {
        var icon = document.createElement("link");
        icon.setAttribute("rel", "icon");
        icon.setAttribute("href", user[0].userimg);
        icon.setAttribute("type", "image/png");
        document.getElementsByTagName("head")[0].appendChild(icon);
        document.getElementById(
          "profile_img_blog"
        ).style.background = `url('${user[0].userimg}') center center`;
        document.getElementById(
          "username_blog"
        ).innerHTML = `<span style="display:${
          user[0].name == null || !user[0].name ? "none" : "block"
        };">${user[0].name}</span>@${user[0].username}<b id="blog_time"></b>`;

        if ((user[0].theme = "dark.css")) {
          document.querySelector("#background_overlay").style.background =
            "linear-gradient(0deg, rgba(10, 10, 10, 1), rgba(10, 10, 10, 0.1))";
        } else {
          document.querySelector("#background_overlay").style.background =
            "linear-gradient(0deg, rgba(255, 255, 255, 1), rgba(255, 255, 255, 0.1))";
        }
      });
    </script>
  

</body></html>
